---
import Layout from '../layouts/Layout.astro'
import Archive from '../templates/Archive.astro'
import Single from '../templates/Single.astro'
import { getNodeByURI } from '../api/uri'
import { getAllUris } from '../api/getUris'
import type { Post } from '../api/uri'

// Return a list of all "fr" resources (pages, posts, tags, categories, etc), existing in the CMS.
export async function getStaticPaths() {
  return await getAllUris('fr')
}

// For the current URI, return the corresponding node from the CMS.
const uri = `/${Astro.params.uri}/`
const data = await getNodeByURI(uri)
const node: Post = data.nodeByUri

// Return the appropriate template for the current node.
function resolveContentTemplate(type: string) {
  let template
  switch (type) {
    case 'Post':
      template = Single
      break
    case 'Page':
      template = Single
      break
    case 'Category':
      template = Archive
      break
    case 'Tag':
      template = Archive
      break
    default:
      template = Single
  }

  return template
}

const Template = resolveContentTemplate(node.__typename)

const seo = {
  title: node.title
}
---

<Layout title={seo.title} description="">
  <Template node={node} />
</Layout>
