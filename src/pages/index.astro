---
import Layout from '../layouts/Layout.astro'
import IndexPosts from '../components/indexPosts.astro'
import { getPostById, getPosts, type Post } from '../api/post'
import { getLangFromUrl } from '../i18n/utils'
import { getSEObyUrl } from '../api/yoast'

const lang = getLangFromUrl(Astro.url)
const postsById = await getPosts(lang)
let posts: Post[] = []
postsById.map(
  async (post) =>
    await getPostById(post.id, lang).then((post) => {
      if (post) posts.push(post)
    })
)

const seo = await getSEObyUrl(import.meta.env.WORDPRESS_INDEX_URL + '/', lang)

Astro.response.headers.set('Cache-Control', 'max-age=600, must-revalidate')
---

<Layout seo={seo}>
  <main>
    <IndexPosts posts={posts} />
  </main>
</Layout>
